<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructor Dashboard - DePaul BlueVox</title>
    <link rel="icon" type="image/png" href="/static/assets/depaul-shield.png">
    
    <!-- UI font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Marck+Script&family=Playfair+Display:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/bluevox.css">
    <style>
      :root {
        --page-text: rgba(255, 255, 255, 0.9);
        --muted: rgba(255, 255, 255, 0.7);
        --accent: rgba(120, 190, 255, 0.75);
        --accent-soft: rgba(90, 160, 255, 0.22);
        --panel-bg: rgba(2, 10, 28, 0.65);
        --panel-border: rgba(120, 175, 255, 0.3);
        --field-bg: rgba(2, 10, 28, 0.38);
        --field-border: rgba(120, 175, 255, 0.55);
        --field-border-focus: rgba(150, 210, 255, 0.85);
        --btn-primary: rgba(70, 150, 255, 0.92);
        --btn-primary-hover: rgba(90, 170, 255, 0.95);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      /* Global input/select/textarea styling to prevent white backgrounds */
      input[type="text"],
      input[type="email"],
      input[type="password"],
      input[type="number"],
      input[type="search"],
      select,
      textarea {
        background: var(--field-bg) !important;
        border: 1px solid var(--field-border) !important;
        color: rgba(255, 255, 255, 0.95) !important;
      }

      input[type="text"]:focus,
      input[type="email"]:focus,
      input[type="password"]:focus,
      input[type="number"]:focus,
      input[type="search"]:focus,
      select:focus,
      textarea:focus {
        outline: none !important;
        border-color: var(--field-border-focus) !important;
        box-shadow: 0 0 0 3px rgba(150, 210, 255, 0.15) !important;
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(255, 255, 255, 0.4) !important;
      }

      /* Fix select option backgrounds */
      select option {
        background: rgba(2, 10, 28, 0.95) !important;
        color: rgba(255, 255, 255, 0.95) !important;
      }

      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      body.bluevox-dashboard {
        margin: 0;
        padding: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        color: var(--page-text);
        overflow-x: hidden;
        min-height: 100vh;
        width: 100%;
        max-width: 100vw;
        background:
          radial-gradient(1100px 760px at 88% 55%, rgba(40, 165, 255, 0.34), rgba(0, 0, 0, 0) 62%),
          radial-gradient(900px 650px at 92% 60%, rgba(20, 120, 255, 0.20), rgba(0, 0, 0, 0) 62%),
          linear-gradient(90deg, #02040b, #031531 55%, #062f67);
        position: relative;
      }

      body.bluevox-dashboard::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image:
          radial-gradient(1px 1px at 12% 18%, rgba(255, 255, 255, 0.75) 50%, transparent 52%),
          radial-gradient(1px 1px at 18% 62%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 28% 78%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 33% 35%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 46% 22%, rgba(255, 255, 255, 0.5) 50%, transparent 52%),
          radial-gradient(1px 1px at 52% 66%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 63% 44%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 71% 77%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 79% 16%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 86% 58%, rgba(255, 255, 255, 0.7) 50%, transparent 52%),
          radial-gradient(1px 1px at 92% 32%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 6% 82%, rgba(255, 255, 255, 0.5) 50%, transparent 52%);
        opacity: 0.55;
        pointer-events: none;
        z-index: 0;
      }

      .dashboard-layout {
        display: flex;
        min-height: 100vh;
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden; /* Prevent layout overflow */
        /* Ensure layout doesn't exceed viewport */
        box-sizing: border-box;
      }

      /* ===== Sidebar ===== */
      .sidebar {
        width: 260px;
        min-width: 180px;
        max-width: 500px;
        background: rgba(2, 10, 28, 0.8);
        backdrop-filter: blur(12px);
        border-right: 1px solid rgba(120, 175, 255, 0.15);
        padding: 32px 24px;
        display: flex;
        flex-direction: column;
        position: fixed;
        left: 0;
        height: 100vh;
        overflow-y: auto;
        transition: width 0.2s ease, left 0.3s ease;
        z-index: 1000;
      }

      .sidebar.collapsed {
        left: -260px !important;
      }


      .sidebar-resize-handle {
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        cursor: col-resize;
        background: transparent;
        z-index: 1001;
        transition: background 0.2s ease;
      }

      .sidebar-resize-handle:hover {
        background: rgba(120, 175, 255, 0.3);
      }

      .sidebar-resize-handle.dragging {
        background: rgba(120, 175, 255, 0.5);
      }


      .sidebar-logo {
        margin-bottom: 48px;
        padding-bottom: 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .sidebar-brand-row {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .sidebar-depaul-logo {
        height: 32px;
        width: auto;
        filter: drop-shadow(0 0 8px rgba(90, 170, 255, 0.2));
      }

      .sidebar-divider {
        width: 1px;
        height: 28px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.5), transparent);
        opacity: 0.7;
      }

      .sidebar-bluevox-text {
        font-family: "Marck Script", cursive;
        font-size: 32px;
        line-height: 1;
        color: rgba(205, 232, 255, 0.95);
        text-shadow:
          0 0 8px rgba(90, 170, 255, 0.2),
          0 0 16px rgba(30, 120, 255, 0.1);
        user-select: none;
      }

      .sidebar-shield {
        width: 48px;
        height: auto;
        margin-top: 6px;
        opacity: 0.95;
        filter: drop-shadow(0 0 8px rgba(90, 170, 255, 0.15));
      }

      .nav-menu {
        list-style: none;
        flex: 1;
      }

      .nav-item {
        margin-bottom: 4px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: 500;
      }

      .nav-link:hover {
        background: rgba(120, 175, 255, 0.15);
        color: rgba(255, 255, 255, 0.9);
      }

      .nav-link.active {
        background: rgba(70, 150, 255, 0.2);
        color: rgba(255, 255, 255, 0.95);
      }

      .nav-link::before {
        content: "";
        width: 3px;
        height: 0;
        background: var(--accent);
        border-radius: 0 2px 2px 0;
        margin-right: 0;
        transition: height 0.2s ease;
      }

      .nav-link.active::before {
        height: 20px;
        margin-right: 12px;
      }

      .sidebar-footer {
        margin-top: auto;
        padding-top: 20px;
        border-top: 1px solid var(--panel-border);
      }

      .logout-btn {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: 500;
        width: 100%;
        background: none;
        border: none;
        cursor: pointer;
      }

      .logout-btn:hover {
        background: rgba(220, 38, 38, 0.2);
        color: rgba(255, 255, 255, 0.9);
      }

      /* ===== Main Content ===== */
      .main-content {
        flex: 1 1 0; /* Don't grow beyond available space */
        margin-left: 260px;
        padding: 32px 40px;
        min-width: 0; /* Allow flex item to shrink below content size */
        max-width: calc(100vw - 260px); /* Explicitly constrain to viewport minus sidebar */
        width: calc(100vw - 260px); /* Explicit width to prevent overflow */
        overflow-x: hidden !important; /* Prevent horizontal overflow at main-content level */
        overflow-y: auto; /* Allow vertical scrolling */
        box-sizing: border-box;
        position: relative;
        /* Ensure content stays to the right of sidebar */
        flex-shrink: 1;
        transition: margin-left 0.2s ease, width 0.2s ease, max-width 0.2s ease;
      }

      .main-content.sidebar-hidden {
        margin-left: 0;
        width: 100vw;
        max-width: 100vw;
      }

      /* Sidebar Tab */
      .sidebar-tab {
        position: fixed;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 80px;
        background: rgba(2, 10, 28, 0.9);
        border: 1px solid rgba(120, 175, 255, 0.3);
        border-left: none;
        border-radius: 0 8px 8px 0;
        cursor: pointer;
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: left 0.3s ease, width 0.2s ease;
        backdrop-filter: blur(12px);
        left: 260px;
      }

      .sidebar-tab:hover {
        background: rgba(2, 10, 28, 0.95);
        border-color: rgba(120, 175, 255, 0.5);
        width: 28px;
      }

      .sidebar-tab.sidebar-visible {
        left: 260px;
      }

      .sidebar-tab-icon {
        color: rgba(255, 255, 255, 0.8);
        font-size: 16px;
        transition: transform 0.3s ease;
        user-select: none;
      }

      .sidebar-tab:hover .sidebar-tab-icon {
        color: rgba(255, 255, 255, 0.95);
      }

      .sidebar-tab.collapsed .sidebar-tab-icon {
        transform: rotate(180deg);
      }

      .sidebar-tab.collapsed {
        left: 0 !important;
      }
      
      /* Ensure all children of main-content are properly constrained */
      .main-content > * {
        max-width: 100% !important;
        box-sizing: border-box !important;
        width: 100% !important;
      }

      .dashboard-header {
        margin-bottom: 32px;
      }

      .welcome-section {
        margin-bottom: 20px;
      }

      .welcome-title {
        font-size: 32px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 6px;
        letter-spacing: -0.5px;
      }

      .welcome-subtitle {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.55);
        font-weight: 400;
        letter-spacing: 0.2px;
      }

      .header-actions {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.9);
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        cursor: pointer;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .btn-primary {
        background: linear-gradient(180deg, var(--btn-primary), rgba(35, 105, 245, 0.88));
        border: 1px solid rgba(170, 220, 255, 0.5);
        color: rgba(255, 255, 255, 0.95);
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .btn-primary:hover {
        background: linear-gradient(180deg, var(--btn-primary-hover), rgba(45, 115, 255, 0.92));
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      /* ===== Panels ===== */
      .panels-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 24px;
      }

      .panel {
        background: var(--panel-bg);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(120, 175, 255, 0.15);
        border-radius: 10px;
        padding: 28px;
        margin-bottom: 24px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
        box-sizing: border-box;
        width: 100%;
        max-width: 100%;
        overflow: hidden; /* Prevent panel content from overflowing - matches teacher_exams.html */
        /* Ensure panel respects parent container */
        min-width: 0;
        position: relative; /* Establish positioning context */
      }

      .panel-full {
        grid-column: 1 / -1;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 14px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden; /* Prevent header content from overflowing */
        min-width: 0; /* Allow flex children to shrink */
      }

      .panel-header > * {
        min-width: 0; /* Allow flex children to shrink */
        flex-shrink: 1; /* Allow buttons to shrink if needed */
      }

      .panel-title {
        font-size: 16px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        letter-spacing: -0.2px;
      }

      .panel-link {
        color: rgba(170, 220, 255, 0.8);
        text-decoration: none;
        font-size: 13px;
        transition: color 0.2s;
      }

      .panel-link:hover {
        color: rgba(220, 245, 255, 0.95);
      }

      .notification-badge {
        background: rgba(220, 38, 38, 0.8);
        color: white;
        border-radius: 12px;
        padding: 2px 8px;
        font-size: 11px;
        font-weight: 600;
        margin-left: 8px;
      }

      .notification-item {
        padding: 14px;
        margin-bottom: 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        border-left: 3px solid rgba(120, 175, 255, 0.5);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .notification-item:hover {
        background: rgba(255, 255, 255, 0.08);
        border-left-color: var(--accent);
      }

      .notification-item.unread {
        background: rgba(90, 160, 255, 0.15);
        border-left-color: var(--accent);
      }

      .notification-title {
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 6px;
        font-size: 14px;
      }

      .notification-message {
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        margin-bottom: 6px;
        line-height: 1.4;
      }

      .notification-time {
        color: rgba(255, 255, 255, 0.5);
        font-size: 11px;
      }

      .no-notifications {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
        text-align: center;
        padding: 30px;
      }

      /* ===== Notifications Page Styles (for SPA navigation) ===== */
      .notifications-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 0;
        position: relative;
        z-index: 1;
      }

      .notifications-container .page-title {
        font-size: 32px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 32px;
        letter-spacing: -0.5px;
      }

      .notifications-container .panel {
        background: var(--panel-bg);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(120, 175, 255, 0.15);
        border-radius: 10px;
        padding: 28px;
        margin-bottom: 24px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
      }

      .notifications-container .notification-item {
        padding: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .notifications-container .notification-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .notifications-container .notification-item:last-child {
        border-bottom: none;
      }

      .notifications-container .notification-item.unread {
        background: rgba(70, 150, 255, 0.1);
        border-left: 3px solid rgba(70, 150, 255, 0.6);
        padding-left: 13px;
      }

      .notifications-container .notification-title {
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 6px;
        font-size: 15px;
      }

      .notifications-container .notification-message {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        margin-bottom: 6px;
        line-height: 1.5;
      }

      .notifications-container .notification-time {
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
      }

      .notifications-container .empty-state {
        padding: 40px;
        text-align: center;
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
      }

      /* ===== Notification Modal Styles ===== */
      .notification-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .notification-modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
      }

      .notification-modal-content {
        position: relative;
        background: var(--panel-bg);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(120, 175, 255, 0.3);
        border-radius: 12px;
        padding: 0;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        z-index: 10001;
        display: flex;
        flex-direction: column;
      }

      .notification-modal-header {
        padding: 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .notification-modal-title {
        font-size: 20px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin: 0;
        flex: 1;
      }

      .notification-modal-close {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        font-size: 28px;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s ease;
      }

      .notification-modal-close:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.95);
      }

      .notification-modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
      }

      .notification-modal-message {
        color: rgba(255, 255, 255, 0.85);
        font-size: 15px;
        line-height: 1.6;
        margin-bottom: 16px;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .notification-modal-time {
        color: rgba(255, 255, 255, 0.5);
        font-size: 13px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .notification-modal-footer {
        padding: 20px 24px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      .notification-modal-footer .btn-primary,
      .notification-modal-footer .btn-secondary {
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
      }

      .notification-modal-footer .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.9);
      }

      .notification-modal-footer .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .notification-modal-footer .btn-delete {
        background: rgba(220, 38, 38, 0.8);
        border: 1px solid rgba(220, 38, 38, 0.6);
        color: rgba(255, 255, 255, 0.95);
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .notification-modal-footer .btn-delete:hover {
        background: rgba(220, 38, 38, 0.95);
        border-color: rgba(220, 38, 38, 0.8);
        transform: translateY(-1px);
      }

      .course-list {
        list-style: none;
      }

      .course-item {
        padding: 12px;
        margin-bottom: 8px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        transition: all 0.2s ease;
      }

      .course-item:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(120, 175, 255, 0.3);
      }

      .course-link {
        color: rgba(170, 220, 255, 0.9);
        text-decoration: none;
        font-weight: 500;
        font-size: 14px;
      }

      .course-link:hover {
        color: rgba(220, 245, 255, 0.95);
      }

      .no-courses {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
        padding: 20px;
        text-align: center;
      }

      /* ===== Tables ===== */
      .table-container {
        overflow-x: auto !important;
        overflow-y: visible;
        border-radius: 8px;
        max-width: 100% !important;
        width: 100% !important;
        box-sizing: border-box !important;
        -webkit-overflow-scrolling: touch;
        /* Ensure scrollbar is visible */
        scrollbar-width: thin;
        scrollbar-color: rgba(120, 175, 255, 0.5) transparent;
        /* Force scrolling when content exceeds container */
        min-width: 0 !important;
        /* Ensure container doesn't exceed parent */
        position: relative;
      }

      .table-container::-webkit-scrollbar {
        height: 8px;
      }

      .table-container::-webkit-scrollbar-track {
        background: rgba(2, 10, 28, 0.3);
        border-radius: 4px;
      }

      .table-container::-webkit-scrollbar-thumb {
        background: rgba(120, 175, 255, 0.5);
        border-radius: 4px;
      }

      .table-container::-webkit-scrollbar-thumb:hover {
        background: rgba(120, 175, 255, 0.7);
      }

      .exams-table {
        width: 100%;
        min-width: 700px; /* Minimum width to prevent cramping, allows scroll - matches teacher_exams.html */
        border-collapse: collapse;
        font-size: 14px;
        table-layout: auto;
        margin: 0; /* Remove any default margins */
        /* Ensure table doesn't force container wider */
        max-width: none; /* Allow table to be wider than container, triggering scroll */
      }

      .exams-table thead {
        background: rgba(70, 150, 255, 0.2);
        border-bottom: 2px solid rgba(120, 175, 255, 0.3);
      }

      .exams-table th {
        padding: 12px 10px;
        text-align: left;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .exams-table td {
        padding: 14px 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
      }

      .exams-table tbody tr {
        transition: background 0.2s ease;
      }

      .exams-table tbody tr:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .exams-table tbody tr a {
        color: rgba(170, 220, 255, 0.9);
        text-decoration: none;
      }

      .exams-table tbody tr a:hover {
        color: rgba(220, 245, 255, 0.95);
        text-decoration: underline;
      }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }

      .status-active .status-dot {
        background: #4CAF50;
        box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
      }

      .status-completed .status-dot,
      .status-submitted .status-dot {
        background: #2196F3;
        box-shadow: 0 0 8px rgba(33, 150, 243, 0.5);
      }

      .status-in-progress .status-dot {
        background: #ff9800;
        box-shadow: 0 0 8px rgba(255, 152, 0, 0.5);
      }

      .status-not-started .status-dot {
        background: #9e9e9e;
      }

      .status-terminated .status-dot {
        background: #dc3545;
        box-shadow: 0 0 8px rgba(220, 53, 69, 0.5);
      }

      .status-active {
        color: #86efac;
      }

      .status-completed,
      .status-submitted {
        color: #93c5fd;
      }

      .status-in-progress {
        color: #fbbf24;
      }

      .status-not-started {
        color: #d1d5db;
      }

      .status-terminated {
        color: #fca5a5;
      }

      .empty-state {
        padding: 40px;
        text-align: center;
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
      }

      /* ===== Responsive ===== */
      @media (max-width: 1200px) {
        .panels-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 240px;
        }
        .main-content {
          margin-left: 240px;
          padding: 20px;
          width: calc(100% - 240px);
          max-width: calc(100vw - 240px);
        }
        .exams-table {
          min-width: 500px; /* Smaller min-width on mobile */
        }
      }
    </style>
</head>

<body class="bluevox-dashboard">
    <div class="dashboard-layout">
        <!-- Sidebar Tab -->
        <div class="sidebar-tab sidebar-visible" id="sidebar-tab">
            <span class="sidebar-tab-icon" id="sidebar-tab-icon">â—€</span>
        </div>
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-resize-handle" id="sidebar-resize-handle"></div>
            <div class="sidebar-logo">
                <div class="sidebar-brand-row">
                    <img class="sidebar-depaul-logo" src="/static/assets/depaul-logo.png" alt="DePaul" />
                    <div class="sidebar-divider" aria-hidden="true"></div>
                    <div class="sidebar-bluevox-text">BlueVox</div>
                </div>
                <img class="sidebar-shield" src="/static/assets/depaul-shield.png" alt="DePaul Shield" />
            </div>
            
            <nav class="nav-menu">
                <ul style="list-style: none; padding: 0;">
                    <li class="nav-item">
                        <a href="/teacher/dashboard" class="nav-link active">
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/manage-students" class="nav-link">
                            Manage Students
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/exams" class="nav-link">
                            Exams
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/analytics" class="nav-link">
                            Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/notifications" class="nav-link">
                            Notifications
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/settings" class="nav-link">
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <a href="/" class="logout-btn">
                    Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Header -->
            <div class="dashboard-header">
                <div class="welcome-section">
                    <h1 class="welcome-title">Welcome, {{ first_name }}</h1>
                    <p class="welcome-subtitle">Instructor Dashboard - Spring 2026</p>
                </div>
                
                <div class="header-actions">
                    <a href="/teacher/register-course" class="btn-secondary">New Course</a>
                    <a href="/teacher/create-exam" class="btn-primary">Create Exam</a>
                </div>
            </div>

            <!-- Panels Grid -->
            <div class="panels-grid">
                <!-- Notifications Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title" style="cursor: pointer;" onclick="window.location.href='/teacher/notifications'">
                            Notifications
                            {% if unread_count > 0 %}
                            <span class="notification-badge">{{ unread_count }}</span>
                            {% endif %}
                        </h2>
                        <a href="/teacher/notifications" class="panel-link">View all</a>
                    </div>
                    {% if notifications %}
                    <div class="notifications-list">
                        {% for notification in notifications[:3] %}
                        <div class="notification-item {% if not notification.is_read %}unread{% else %}read{% endif %}" 
                             data-notification-id="{{ notification.id }}"
                             data-notification-title="{{ notification.title }}"
                             data-notification-message="{{ notification.message }}"
                             data-notification-time="{{ notification.created_at.strftime('%Y-%m-%d %H:%M') if notification.created_at else '' }}"
                             data-notification-unread="{{ 'true' if not notification.is_read else 'false' }}"
                             onclick="openNotificationModal(this)">
                            <div class="notification-title">{{ notification.title }}</div>
                            <div class="notification-message">{{ notification.message[:80] }}{% if notification.message|length > 80 %}...{% endif %}</div>
                            <div class="notification-time">{{ notification.created_at.strftime('%Y-%m-%d %H:%M') if notification.created_at else '' }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="no-notifications">No notifications</p>
                    {% endif %}
                </div>

                <!-- Quick Actions Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Quick Actions</h2>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.7); font-size: 12px; margin-bottom: 6px;">Course</label>
                            <select style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">
                                {% if courses %}
                                {% for course in courses %}
                                <option value="{{ course.course_number }}-{{ course.section }}">{{ course.course_number }} - {{ course.section }}</option>
                                {% endfor %}
                                {% else %}
                                <option>No courses</option>
                                {% endif %}
                            </select>
                        </div>
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.7); font-size: 12px; margin-bottom: 6px;">Search</label>
                            <input type="text" placeholder="Search student / exam" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <a href="/teacher/exams?filter=open" class="btn-primary" style="flex: 1; padding: 10px; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center;">Open Exams</a>
                            <a href="/teacher/exams?filter=closed" class="btn-secondary" style="flex: 1; padding: 10px; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center;">Closed Exams</a>
                        </div>
                    </div>
                </div>

                <!-- Courses Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Courses</h2>
                    </div>
                    {% if courses %}
                    <ul class="course-list">
                        {% for course in courses %}
                        <li class="course-item">
                            <a href="/teacher/course/{{ course.course_number }}/{{ course.section }}" class="course-link">
                                {{ course.course_number }} - Section {{ course.section }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="no-courses">You have no active courses</p>
                    {% endif %}
                    <a href="/teacher/register-course" class="btn-primary" style="display: inline-block; margin-top: 15px; width: 100%; text-align: center;">Register New Course</a>
                </div>

                <!-- Create Exam Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Create New Exam</h2>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 15px; font-size: 14px;">Create and configure a new exam for your courses.</p>
                    <a href="/teacher/create-exam" class="btn-primary" style="display: inline-block; width: 100%; text-align: center;">Create New Exam</a>
                </div>
            </div>
        </div>
        </main>
    </div>

    <!-- Notification Modal -->
    <div id="notification-modal" class="notification-modal" style="display: none;">
        <div class="notification-modal-overlay" id="notification-modal-overlay"></div>
        <div class="notification-modal-content">
            <div class="notification-modal-header">
                <h2 id="modal-notification-title" class="notification-modal-title"></h2>
                <button class="notification-modal-close" id="notification-modal-close-btn">&times;</button>
            </div>
            <div class="notification-modal-body">
                <div id="modal-notification-message" class="notification-modal-message"></div>
                <div id="modal-notification-time" class="notification-modal-time"></div>
            </div>
            <div class="notification-modal-footer">
                <button id="modal-delete-btn" class="btn-delete">Delete</button>
                <button id="modal-mark-read-btn" class="btn-primary" style="display: none;">Mark as Read</button>
                <button id="notification-modal-close-btn-footer" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <script>
        // SPA Navigation Handler
        (function() {
            const mainContent = document.getElementById('main-content');
            const navLinks = document.querySelectorAll('.nav-link[href^="/teacher/"]');
            const headerActions = document.querySelectorAll('.header-actions a[href^="/teacher/"]');
            const allTeacherLinks = [...navLinks, ...headerActions];
            
            // Store original dashboard HTML
            const originalContent = mainContent.innerHTML;
            
            // Loading state
            let isLoading = false;
            
            // Add loading overlay
            function showLoading() {
                if (isLoading) return;
                isLoading = true;
                const overlay = document.createElement('div');
                overlay.id = 'loading-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(2, 10, 28, 0.7);
                    backdrop-filter: blur(4px);
                    z-index: 9999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    opacity: 0;
                    transition: opacity 0.2s ease;
                `;
                overlay.innerHTML = `
                    <div style="color: rgba(255, 255, 255, 0.9); font-size: 18px; font-weight: 500;">
                        Loading...
                    </div>
                `;
                document.body.appendChild(overlay);
                setTimeout(() => overlay.style.opacity = '1', 10);
            }
            
            function hideLoading() {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.remove(), 200);
                }
                isLoading = false;
            }
            
            // Extract main content from HTML
            function extractMainContent(html) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Try to find main content in order of preference
                let main = doc.querySelector('main.main-content');
                if (!main) {
                    main = doc.querySelector('main');
                }
                if (!main) {
                    // For standalone pages like manage_students that have their own container
                    // Extract just the container content, not the whole page structure
                    // Check for specific containers first (order matters - most specific first)
                    const container = doc.querySelector('.notifications-container') ||
                                     doc.querySelector('.manage-container') || 
                                     doc.querySelector('.exams-container') ||
                                     doc.querySelector('.analytics-container') ||
                                     doc.querySelector('.settings-container') ||
                                     doc.querySelector('.review-container') ||
                                     doc.querySelector('.details-container') ||
                                     doc.querySelector('.form-container') ||
                                     doc.querySelector('.container');
                    if (container) {
                        // Return the container's innerHTML - this is the page content
                        // Also include any style tags that might be needed
                        const styles = doc.querySelectorAll('style');
                        let stylesHTML = '';
                        styles.forEach(style => {
                            stylesHTML += style.outerHTML;
                        });
                        const content = container.innerHTML;
                        if (!content || content.trim().length === 0) {
                            console.warn('Container found but content is empty:', container.className);
                        }
                        return stylesHTML + content;
                    }
                }
                
                // If we found a main element, extract its content
                if (main) {
                    return main.innerHTML;
                }
                
                // Fallback: try to get body content excluding sidebar and dashboard layout
                const body = doc.body;
                const sidebar = body.querySelector('.sidebar, aside');
                const dashboardLayout = body.querySelector('.dashboard-layout');
                
                if (dashboardLayout) {
                    // If there's a dashboard layout, extract just the main-content from it
                    const mainContent = dashboardLayout.querySelector('main.main-content') || dashboardLayout.querySelector('main');
                    if (mainContent) {
                        return mainContent.innerHTML;
                    }
                }
                
                if (sidebar) {
                    // Remove sidebar and return rest
                    const clone = body.cloneNode(true);
                    const sidebarClone = clone.querySelector('.sidebar, aside');
                    if (sidebarClone) sidebarClone.remove();
                    const layoutClone = clone.querySelector('.dashboard-layout');
                    if (layoutClone) {
                        const mainClone = layoutClone.querySelector('main');
                        if (mainClone) return mainClone.innerHTML;
                    }
                }
                
                // Last resort: return body content but try to exclude common page structure
                const bodyContent = body.innerHTML;
                // Remove any script tags that might cause issues
                return bodyContent.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
            }
            
            // Update active nav link
            function updateActiveNav(href) {
                navLinks.forEach(link => {
                    if (link.getAttribute('href') === href) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
            
            // Load page content
            async function loadPage(url) {
                if (isLoading) return;
                
                showLoading();
                
                try {
                    const response = await fetch(url, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'Accept': 'text/html'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const html = await response.text();
                    const content = extractMainContent(html);
                    
                    // Fade out
                    mainContent.style.opacity = '0';
                    mainContent.style.transition = 'opacity 0.2s ease';
                    
                    setTimeout(() => {
                        // Ensure sidebar and layout structure are still present before replacing content
                        const sidebar = document.querySelector('.sidebar');
                        const dashboardLayout = document.querySelector('.dashboard-layout');
                        
                        if (!sidebar || !dashboardLayout || !mainContent) {
                            // Critical structure missing, reload page normally
                            console.error('Dashboard structure missing, reloading page');
                            window.location.href = url;
                            return;
                        }
                        
                        // Only replace the main content, never the sidebar
                        if (mainContent && mainContent.parentNode === dashboardLayout) {
                            // Check if content was extracted successfully
                            if (!content || content.trim().length === 0) {
                                console.error('No content extracted, reloading page');
                                window.location.href = url;
                                return;
                            }
                            
                            mainContent.innerHTML = content;
                            updateActiveNav(url);
                            
                            // Re-initialize any scripts or event handlers in the new content
                            initializePageContent();
                            
                            // Fade in
                            setTimeout(() => {
                                mainContent.style.opacity = '1';
                            }, 10);
                            
                            hideLoading();
                        } else {
                            // Main content is not in the right place, reload
                            console.error('Main content structure invalid, reloading page');
                            window.location.href = url;
                        }
                    }, 200);
                    
                    // Update URL without reload
                    window.history.pushState({ url: url }, '', url);
                    
                } catch (error) {
                    console.error('Error loading page:', error);
                    hideLoading();
                    mainContent.style.opacity = '1';
                    alert('Error loading page. Please try again.');
                }
            }
            
            // Check for redirect after dashboard load
            (function checkRedirect() {
                const redirectPath = sessionStorage.getItem('redirectAfterDashboard');
                if (redirectPath) {
                    sessionStorage.removeItem('redirectAfterDashboard');
                    // Small delay to ensure dashboard is fully loaded
                    setTimeout(() => {
                        loadPage(redirectPath);
                    }, 100);
                }
            })();
            
            // Notification Modal Functions
            let currentNotificationId = null;
            let currentNotificationElement = null;
            
            function openNotificationModal(element) {
                currentNotificationElement = element;
                currentNotificationId = parseInt(element.getAttribute('data-notification-id'));
                const title = element.getAttribute('data-notification-title');
                const message = element.getAttribute('data-notification-message');
                const time = element.getAttribute('data-notification-time');
                const isUnread = element.getAttribute('data-notification-unread') === 'true';
                
                document.getElementById('modal-notification-title').textContent = title;
                document.getElementById('modal-notification-message').textContent = message;
                document.getElementById('modal-notification-time').textContent = 'Received: ' + time;
                
                const markReadBtn = document.getElementById('modal-mark-read-btn');
                if (isUnread) {
                    markReadBtn.style.display = 'inline-block';
                } else {
                    markReadBtn.style.display = 'none';
                }
                
                const modal = document.getElementById('notification-modal');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
            
            function closeNotificationModal() {
                const modal = document.getElementById('notification-modal');
                if (modal) {
                    modal.style.display = 'none';
                }
                document.body.style.overflow = '';
                currentNotificationId = null;
                currentNotificationElement = null;
            }
            
            // Set up modal event listeners
            (function setupModalListeners() {
                const modal = document.getElementById('notification-modal');
                const overlay = document.getElementById('notification-modal-overlay');
                const closeBtn = document.getElementById('notification-modal-close-btn');
                const closeBtnFooter = document.getElementById('notification-modal-close-btn-footer');
                const modalContent = document.querySelector('.notification-modal-content');
                
                if (overlay) {
                    overlay.addEventListener('click', function(e) {
                        e.stopPropagation();
                        closeNotificationModal();
                    });
                }
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        closeNotificationModal();
                    });
                }
                
                if (closeBtnFooter) {
                    closeBtnFooter.addEventListener('click', function(e) {
                        e.stopPropagation();
                        closeNotificationModal();
                    });
                }
                
                if (modalContent) {
                    modalContent.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                }
                
                if (modal) {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            closeNotificationModal();
                        }
                    });
                }
            })();
            
            async function markNotificationAsRead() {
                if (!currentNotificationId) return;
                
                try {
                    const response = await fetch(`/api/notification/${currentNotificationId}/read?redirect=/teacher/dashboard`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (response.ok || response.redirected) {
                        // Update the notification item in the list
                        if (currentNotificationElement) {
                            currentNotificationElement.classList.remove('unread');
                            currentNotificationElement.classList.add('read');
                            currentNotificationElement.setAttribute('data-notification-unread', 'false');
                        }
                        
                        // Hide the mark as read button
                        document.getElementById('modal-mark-read-btn').style.display = 'none';
                        
                        // Update unread count badge if it exists
                        const badge = document.querySelector('.notification-badge');
                        if (badge) {
                            const currentCount = parseInt(badge.textContent) || 0;
                            if (currentCount > 1) {
                                badge.textContent = currentCount - 1;
                            } else {
                                badge.remove();
                            }
                        }
                        
                        // Reload the page to refresh notification count and list
                        setTimeout(() => {
                            window.location.reload();
                        }, 500);
                    }
                } catch (error) {
                    console.error('Error marking notification as read:', error);
                    alert('Error marking notification as read. Please try again.');
                }
            }
            
            async function deleteNotification() {
                if (!currentNotificationId) return;
                
                if (!confirm('Are you sure you want to delete this notification?')) {
                    return;
                }
                
                try {
                    const response = await fetch(`/api/notification/${currentNotificationId}`, {
                        method: 'DELETE',
                        credentials: 'include',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // Remove the notification item from the list
                        if (currentNotificationElement) {
                            currentNotificationElement.style.transition = 'opacity 0.3s ease';
                            currentNotificationElement.style.opacity = '0';
                            setTimeout(() => {
                                currentNotificationElement.remove();
                            }, 300);
                        }
                        
                        // Update unread count badge if it exists
                        const badge = document.querySelector('.notification-badge');
                        if (badge && currentNotificationElement && currentNotificationElement.classList.contains('unread')) {
                            const currentCount = parseInt(badge.textContent) || 0;
                            if (currentCount > 1) {
                                badge.textContent = currentCount - 1;
                            } else {
                                badge.remove();
                            }
                        }
                        
                        // Close the modal
                        closeNotificationModal();
                        
                        // Reload the page to refresh the notification list
                        setTimeout(() => {
                            window.location.reload();
                        }, 500);
                    } else {
                        alert('Error deleting notification: ' + (data.error || 'Unknown error'));
                    }
                } catch (error) {
                    console.error('Error deleting notification:', error);
                    alert('Error deleting notification. Please try again.');
                }
            }
            
            // Set up delete button listener
            (function setupDeleteButton() {
                const deleteBtn = document.getElementById('modal-delete-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteNotification();
                    });
                }
            })();
            
            // Set up mark as read button listener
            (function setupMarkReadButton() {
                const markReadBtn = document.getElementById('modal-mark-read-btn');
                if (markReadBtn) {
                    markReadBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        markNotificationAsRead();
                    });
                }
            })();
            
            // Close modal on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('notification-modal');
                    if (modal && modal.style.display === 'flex') {
                        closeNotificationModal(e);
                    }
                }
            });
            
            // Initialize page-specific content
            function initializePageContent() {
                // Re-attach event listeners for any dynamic content
                const newLinks = mainContent.querySelectorAll('a[href^="/teacher/"]');
                newLinks.forEach(link => {
                    link.addEventListener('click', handleLinkClick);
                });
                
                // Re-initialize notification items for modal
                const notificationItems = mainContent.querySelectorAll('.notification-item[data-notification-id]');
                notificationItems.forEach(item => {
                    // Remove any existing click handlers and add the modal handler
                    item.onclick = function(e) {
                        e.stopPropagation();
                        openNotificationModal(this);
                    };
                });
                
                // Re-initialize forms if needed
                const forms = mainContent.querySelectorAll('form');
                forms.forEach(form => {
                    form.addEventListener('submit', function(e) {
                        // Let forms submit normally for now
                        // Can be enhanced later for AJAX form submission
                    });
                });
            }
            
            // Handle link clicks
            function handleLinkClick(e) {
                const link = e.currentTarget;
                const href = link.getAttribute('href');
                
                // Skip if it's a hash link or external link
                if (!href || href.startsWith('#') || href.startsWith('http')) {
                    return;
                }
                
                // Skip logout and external links
                if (href === '/' || href.startsWith('/api/') || href.startsWith('/student/')) {
                    return; // Let these navigate normally
                }
                
                // Use full page navigation for pages with complex client-side scripts.
                // These forms rely on inline scripts that don't run when loaded via SPA fetch.
                if (href.includes('register-course') || href.includes('create-exam')) {
                    return; // Full page load - scripts need to execute
                }
                
                // Only handle teacher dashboard routes
                if (href.startsWith('/teacher/')) {
                    e.preventDefault();
                    loadPage(href);
                }
            }
            
            // Handle browser back/forward
            window.addEventListener('popstate', function(e) {
                const currentUrl = window.location.pathname;
                if (currentUrl.startsWith('/teacher/')) {
                    // Ensure sidebar exists before loading
                    const sidebar = document.querySelector('.sidebar');
                    if (!sidebar) {
                        // Reload page if sidebar is missing
                        window.location.href = currentUrl;
                        return;
                    }
                    loadPage(currentUrl);
                } else {
                    // Load dashboard if no state
                    const sidebar = document.querySelector('.sidebar');
                    if (!sidebar) {
                        window.location.href = '/teacher/dashboard';
                        return;
                    }
                    mainContent.innerHTML = originalContent;
                    updateActiveNav('/teacher/dashboard');
                    initializePageContent();
                }
            });
            
            // Set initial state for browser history
            window.history.replaceState({ url: window.location.pathname }, '', window.location.pathname);
            
            // Ensure sidebar is always present
            function ensureSidebar() {
                const sidebar = document.querySelector('.sidebar');
                const dashboardLayout = document.querySelector('.dashboard-layout');
                
                if (!sidebar && window.location.pathname.startsWith('/teacher/')) {
                    // Sidebar is missing - reload page to restore it
                    console.warn('Sidebar missing, reloading page');
                    window.location.reload();
                    return false;
                }
                
                // Ensure main-content exists
                if (!mainContent && dashboardLayout) {
                    // Main content was removed, reload
                    console.warn('Main content missing, reloading page');
                    window.location.reload();
                    return false;
                }
                
                return true;
            }
            
            // Check sidebar on page load
            if (!ensureSidebar()) {
                return; // Page will reload
            }
            
            // Monitor sidebar to ensure it stays present
            const observer = new MutationObserver(function(mutations) {
                ensureSidebar();
            });
            
            // Observe the dashboard layout for changes
            const dashboardLayout = document.querySelector('.dashboard-layout');
            if (dashboardLayout) {
                observer.observe(dashboardLayout, { 
                    childList: true, 
                    subtree: true,
                    attributes: false
                });
            }
            
            // Also check periodically (as a safety net)
            setInterval(function() {
                if (window.location.pathname.startsWith('/teacher/')) {
                    ensureSidebar();
                }
            }, 1000);
            
            // Attach click handlers to all teacher links
            allTeacherLinks.forEach(link => {
                link.addEventListener('click', handleLinkClick);
            });
            
            // Also handle clicks on links within main content (for exam links, etc.)
            mainContent.addEventListener('click', function(e) {
                const link = e.target.closest('a[href^="/teacher/"]');
                if (link) {
                    handleLinkClick(e);
                }
            });
            
            // Initialize on page load
            initializePageContent();
            
            // Also initialize notification items on initial page load
            document.addEventListener('DOMContentLoaded', function() {
                const notificationItems = document.querySelectorAll('.notification-item[data-notification-id]');
                notificationItems.forEach(item => {
                    item.onclick = function(e) {
                        e.stopPropagation();
                        openNotificationModal(this);
                    };
                });
            });
        })();

        // Sidebar Resize and Toggle Functionality
        (function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const resizeHandle = document.getElementById('sidebar-resize-handle');
            const sidebarTab = document.getElementById('sidebar-tab');
            
            if (!sidebar || !mainContent || !resizeHandle || !sidebarTab) return;
            
            // Load saved sidebar state
            const savedWidth = localStorage.getItem('sidebarWidth');
            const savedVisibility = localStorage.getItem('sidebarVisible');
            
            // Define helper functions first
            function updateMainContentMargin(sidebarWidth) {
                if (!sidebar.classList.contains('collapsed')) {
                    mainContent.style.marginLeft = sidebarWidth + 'px';
                    mainContent.style.width = `calc(100vw - ${sidebarWidth}px)`;
                    mainContent.style.maxWidth = `calc(100vw - ${sidebarWidth}px)`;
                }
            }
            
            function updateTabPosition(sidebarWidth) {
                if (!sidebar.classList.contains('collapsed')) {
                    sidebarTab.style.left = sidebarWidth + 'px';
                }
            }
            
            const sidebarTabIcon = document.getElementById('sidebar-tab-icon');
            
            if (savedWidth) {
                sidebar.style.width = savedWidth + 'px';
                updateMainContentMargin(parseInt(savedWidth));
                updateTabPosition(parseInt(savedWidth));
            }
            
            if (savedVisibility === 'false') {
                // Initialize hidden state
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebar.style.left = `-${sidebarWidth}px`;
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-hidden');
                sidebarTab.classList.add('collapsed');
                sidebarTab.classList.remove('sidebar-visible');
                sidebarTab.style.left = '0';
                if (sidebarTabIcon) sidebarTabIcon.textContent = 'â–¶';
                // Expand main content to full width
                mainContent.style.marginLeft = '0';
                mainContent.style.width = '100vw';
                mainContent.style.maxWidth = '100vw';
            }
            
            // Tab toggle functionality
            let isDraggingTab = false;
            let dragStartX = 0;
            let dragStartLeft = 0;
            let hasMoved = false;
            
            sidebarTab.addEventListener('mousedown', function(e) {
                isDraggingTab = true;
                hasMoved = false;
                dragStartX = e.clientX;
                dragStartLeft = sidebar.classList.contains('collapsed') ? 0 : parseInt(window.getComputedStyle(sidebar).width, 10);
                document.body.style.cursor = 'grabbing';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDraggingTab) return;
                
                const deltaX = e.clientX - dragStartX;
                
                // Check if user has moved the mouse significantly
                if (Math.abs(deltaX) > 5) {
                    hasMoved = true;
                }
                
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                const newLeft = dragStartLeft + deltaX;
                
                // Update tab position during drag for visual feedback
                if (sidebar.classList.contains('collapsed')) {
                    // When hidden, tab can only move right
                    sidebarTab.style.left = Math.max(0, newLeft) + 'px';
                } else {
                    // When visible, tab can only move left
                    sidebarTab.style.left = Math.min(sidebarWidth, newLeft) + 'px';
                }
            });
            
            document.addEventListener('mouseup', function(e) {
                if (isDraggingTab) {
                    const deltaX = e.clientX - dragStartX;
                    
                    // If user dragged significantly, toggle based on direction
                    if (hasMoved && Math.abs(deltaX) > 20) {
                        if (deltaX < -20 && !sidebar.classList.contains('collapsed')) {
                            // Dragged left - hide sidebar
                            hideSidebar();
                        } else if (deltaX > 20 && sidebar.classList.contains('collapsed')) {
                            // Dragged right - show sidebar
                            showSidebar();
                        } else {
                            // Reset tab position
                            resetTabPosition();
                        }
                    } else if (!hasMoved) {
                        // Simple click - toggle
                        if (sidebar.classList.contains('collapsed')) {
                            showSidebar();
                        } else {
                            hideSidebar();
                        }
                    } else {
                        // Small movement - reset position
                        resetTabPosition();
                    }
                    
                    isDraggingTab = false;
                    hasMoved = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
            
            function resetTabPosition() {
                const isHidden = sidebar.classList.contains('collapsed');
                if (isHidden) {
                    sidebarTab.style.left = '0';
                } else {
                    const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                    sidebarTab.style.left = sidebarWidth + 'px';
                }
            }
            
            function hideSidebar() {
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebar.style.left = `-${sidebarWidth}px`;
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-hidden');
                sidebarTab.classList.add('collapsed');
                sidebarTab.classList.remove('sidebar-visible');
                sidebarTab.style.left = '0';
                if (sidebarTabIcon) sidebarTabIcon.textContent = 'â–¶';
                // Expand main content to full width
                mainContent.style.marginLeft = '0';
                mainContent.style.width = '100vw';
                mainContent.style.maxWidth = '100vw';
                localStorage.setItem('sidebarVisible', 'false');
            }
            
            function showSidebar() {
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebar.style.left = '0';
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('sidebar-hidden');
                sidebarTab.classList.remove('collapsed');
                sidebarTab.classList.add('sidebar-visible');
                sidebarTab.style.left = sidebarWidth + 'px';
                if (sidebarTabIcon) sidebarTabIcon.textContent = 'â—€';
                // Adjust main content to account for sidebar
                updateMainContentMargin(sidebarWidth);
                localStorage.setItem('sidebarVisible', 'true');
            }
            
            // Make functions globally accessible for debugging
            window.hideSidebar = hideSidebar;
            window.showSidebar = showSidebar;
            
            function toggleSidebar() {
                if (sidebar.classList.contains('collapsed')) {
                    showSidebar();
                } else {
                    hideSidebar();
                }
            }
            
            // Resize functionality
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;
            
            resizeHandle.addEventListener('mousedown', function(e) {
                isResizing = true;
                startX = e.clientX;
                startWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                resizeHandle.classList.add('dragging');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;
                
                const width = startWidth + (e.clientX - startX);
                const minWidth = 180;
                const maxWidth = 500;
                
                if (width >= minWidth && width <= maxWidth) {
                    sidebar.style.width = width + 'px';
                    updateMainContentMargin(width);
                    updateTabPosition(width);
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    resizeHandle.classList.remove('dragging');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    
                    // Save width to localStorage
                    const currentWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                    localStorage.setItem('sidebarWidth', currentWidth);
                }
            });
            
            // Initialize tab position
            if (!sidebar.classList.contains('collapsed')) {
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebarTab.style.left = sidebarWidth + 'px';
            }
        })();
    </script>
</body>
</html>
