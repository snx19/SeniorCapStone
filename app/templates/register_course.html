<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register New Course - DePaul BlueVox</title>
    <link rel="icon" type="image/png" href="/static/assets/depaul-shield.png">
    
    <!-- UI font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/bluevox.css">
    <style>
      :root {
        --page-text: rgba(255, 255, 255, 0.9);
        --muted: rgba(255, 255, 255, 0.7);
        --accent: rgba(120, 190, 255, 0.75);
        --accent-soft: rgba(90, 160, 255, 0.22);
        --panel-bg: rgba(2, 10, 28, 0.65);
        --panel-border: rgba(120, 175, 255, 0.3);
        --field-bg: rgba(2, 10, 28, 0.38);
        --field-border: rgba(120, 175, 255, 0.55);
        --field-border-focus: rgba(150, 210, 255, 0.85);
        --btn-primary: rgba(70, 150, 255, 0.92);
        --btn-primary-hover: rgba(90, 170, 255, 0.95);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      /* Global input/select/textarea styling to prevent white backgrounds */
      input[type="text"],
      input[type="email"],
      input[type="password"],
      input[type="number"],
      input[type="search"],
      select,
      textarea {
        background: var(--field-bg) !important;
        border: 1px solid var(--field-border) !important;
        color: rgba(255, 255, 255, 0.95) !important;
      }

      input[type="text"]:focus,
      input[type="email"]:focus,
      input[type="password"]:focus,
      input[type="number"]:focus,
      input[type="search"]:focus,
      select:focus,
      textarea:focus {
        outline: none !important;
        border-color: var(--field-border-focus) !important;
        box-shadow: 0 0 0 3px rgba(150, 210, 255, 0.15) !important;
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(255, 255, 255, 0.4) !important;
      }

      select option {
        background: rgba(2, 10, 28, 0.95) !important;
        color: rgba(255, 255, 255, 0.95) !important;
      }

      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      body.bluevox-form {
        margin: 0;
        padding: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        color: var(--page-text);
        overflow-x: hidden;
        min-height: 100vh;
        background:
          radial-gradient(1100px 760px at 88% 55%, rgba(40, 165, 255, 0.34), rgba(0, 0, 0, 0) 62%),
          radial-gradient(900px 650px at 92% 60%, rgba(20, 120, 255, 0.20), rgba(0, 0, 0, 0) 62%),
          linear-gradient(90deg, #02040b, #031531 55%, #062f67);
        position: relative;
      }

      /* Dashboard Layout */
      .dashboard-layout {
        display: flex;
        min-height: 100vh;
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden;
        box-sizing: border-box;
      }

      /* Sidebar Styles */
      .sidebar {
        width: 260px;
        min-width: 180px;
        max-width: 500px;
        background: rgba(2, 10, 28, 0.8);
        backdrop-filter: blur(12px);
        border-right: 1px solid rgba(120, 175, 255, 0.15);
        padding: 32px 24px;
        display: flex;
        flex-direction: column;
        position: fixed;
        left: 0;
        height: 100vh;
        overflow-y: auto;
        transition: width 0.2s ease, left 0.3s ease;
        z-index: 1000;
      }

      .sidebar.collapsed {
        left: -260px !important;
      }

      .sidebar-resize-handle {
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        cursor: col-resize;
        background: transparent;
        z-index: 1001;
        transition: background 0.2s ease;
      }

      .sidebar-resize-handle:hover {
        background: rgba(120, 175, 255, 0.3);
      }

      .sidebar-resize-handle.dragging {
        background: rgba(120, 175, 255, 0.5);
      }

      /* Sidebar Tab */
      .sidebar-tab {
        position: fixed;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 80px;
        background: rgba(2, 10, 28, 0.9);
        border: 1px solid rgba(120, 175, 255, 0.3);
        border-left: none;
        border-radius: 0 8px 8px 0;
        cursor: pointer;
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: left 0.3s ease, width 0.2s ease;
        backdrop-filter: blur(12px);
        left: 260px;
      }

      .sidebar-tab:hover {
        background: rgba(2, 10, 28, 0.95);
        border-color: rgba(120, 175, 255, 0.5);
        width: 28px;
      }

      .sidebar-tab.sidebar-visible {
        left: 260px;
      }

      .sidebar-tab-icon {
        color: rgba(255, 255, 255, 0.8);
        font-size: 16px;
        transition: transform 0.3s ease;
        user-select: none;
      }

      .sidebar-tab:hover .sidebar-tab-icon {
        color: rgba(255, 255, 255, 0.95);
      }

      .sidebar-tab.collapsed .sidebar-tab-icon {
        transform: rotate(180deg);
      }

      .sidebar-tab.collapsed {
        left: 0 !important;
      }


      .sidebar-resize-handle {
        position: absolute;
        top: 0;
        right: 0;
        width: 4px;
        height: 100%;
        cursor: col-resize;
        background: transparent;
        z-index: 1001;
        transition: background 0.2s ease;
      }

      .sidebar-resize-handle:hover {
        background: rgba(120, 175, 255, 0.3);
      }

      .sidebar-resize-handle.dragging {
        background: rgba(120, 175, 255, 0.5);
      }


      .sidebar-logo {
        margin-bottom: 48px;
        padding-bottom: 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .sidebar-brand-row {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .sidebar-depaul-logo {
        height: 32px;
        width: auto;
        filter: drop-shadow(0 0 8px rgba(90, 170, 255, 0.2));
      }

      .sidebar-divider {
        width: 1px;
        height: 28px;
        background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.5), transparent);
        opacity: 0.7;
      }

      .sidebar-bluevox-text {
        font-family: "Marck Script", cursive;
        font-size: 32px;
        line-height: 1;
        color: rgba(205, 232, 255, 0.95);
        text-shadow:
          0 0 8px rgba(90, 170, 255, 0.2),
          0 0 16px rgba(30, 120, 255, 0.1);
        user-select: none;
      }

      .sidebar-shield {
        width: 48px;
        height: auto;
        margin-top: 6px;
        opacity: 0.95;
        filter: drop-shadow(0 0 8px rgba(90, 170, 255, 0.15));
      }

      .nav-menu {
        list-style: none;
        flex: 1;
      }

      .nav-item {
        margin-bottom: 4px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: 500;
      }

      .nav-link:hover {
        background: rgba(120, 175, 255, 0.15);
        color: rgba(255, 255, 255, 0.9);
      }

      .nav-link.active {
        background: rgba(70, 150, 255, 0.2);
        color: rgba(255, 255, 255, 0.95);
      }

      .nav-link::before {
        content: "";
        width: 3px;
        height: 0;
        background: var(--accent);
        border-radius: 0 2px 2px 0;
        margin-right: 0;
        transition: height 0.2s ease;
      }

      .nav-link.active::before {
        height: 20px;
        margin-right: 12px;
      }

      .sidebar-footer {
        margin-top: auto;
        padding-top: 20px;
        border-top: 1px solid var(--panel-border);
      }

      .logout-btn {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: 500;
        width: 100%;
        background: none;
        border: none;
        cursor: pointer;
      }

      .logout-btn:hover {
        background: rgba(220, 38, 38, 0.2);
        color: rgba(255, 255, 255, 0.9);
      }

      /* Main Content */
      .main-content {
        flex: 1 1 0;
        margin-left: 260px;
        padding: 32px 40px;
        min-width: 0;
        max-width: calc(100vw - 260px);
        width: calc(100vw - 260px);
        overflow-x: hidden !important;
        overflow-y: auto;
        box-sizing: border-box;
        position: relative;
        flex-shrink: 1;
        transition: margin-left 0.2s ease, width 0.2s ease, max-width 0.2s ease;
      }


      body.bluevox-form::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image:
          radial-gradient(1px 1px at 12% 18%, rgba(255, 255, 255, 0.75) 50%, transparent 52%),
          radial-gradient(1px 1px at 18% 62%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 28% 78%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 33% 35%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 46% 22%, rgba(255, 255, 255, 0.5) 50%, transparent 52%),
          radial-gradient(1px 1px at 52% 66%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 63% 44%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 71% 77%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 79% 16%, rgba(255, 255, 255, 0.6) 50%, transparent 52%),
          radial-gradient(1px 1px at 86% 58%, rgba(255, 255, 255, 0.7) 50%, transparent 52%),
          radial-gradient(1px 1px at 92% 32%, rgba(255, 255, 255, 0.55) 50%, transparent 52%),
          radial-gradient(1px 1px at 6% 82%, rgba(255, 255, 255, 0.5) 50%, transparent 52%);
        opacity: 0.55;
        pointer-events: none;
        z-index: 0;
      }

      .form-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 40px 20px;
        position: relative;
        z-index: 1;
      }

      .form-card {
        width: 100%;
        max-width: 600px;
        background: var(--panel-bg);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(120, 175, 255, 0.15);
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      }

      .form-header {
        margin-bottom: 32px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .form-header h1 {
        font-size: 28px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 8px;
        letter-spacing: -0.5px;
      }

      .back-link {
        color: rgba(170, 220, 255, 0.8);
        text-decoration: none;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: color 0.2s;
      }

      .back-link:hover {
        color: rgba(220, 245, 255, 0.95);
      }

      .form-group {
        margin-bottom: 24px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
        font-size: 14px;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 16px;
        background: var(--field-bg);
        border: 1px solid var(--field-border);
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.95);
        font-size: 14px;
        font-family: Inter, sans-serif;
        transition: all 0.2s ease;
        box-sizing: border-box;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--field-border-focus);
        box-shadow: 0 0 0 3px rgba(150, 210, 255, 0.15);
      }

      .form-group input::placeholder {
        color: rgba(255, 255, 255, 0.4);
      }

      .form-group input[type="text"] {
        text-transform: uppercase;
      }

      .info-text {
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
        margin-top: 6px;
        line-height: 1.4;
      }

      .sections-container {
        margin-bottom: 12px;
      }

      .section-input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }

      .section-input-group input {
        flex: 1;
        text-transform: none;
      }

      .btn-remove-section {
        padding: 10px 16px;
        background: rgba(220, 38, 38, 0.2);
        border: 1px solid rgba(220, 38, 38, 0.4);
        color: rgba(255, 255, 255, 0.9);
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .btn-remove-section:hover {
        background: rgba(220, 38, 38, 0.3);
        border-color: rgba(220, 38, 38, 0.6);
      }

      .btn-add-section {
        padding: 10px 16px;
        background: rgba(70, 150, 255, 0.2);
        border: 1px solid rgba(70, 150, 255, 0.4);
        color: rgba(255, 255, 255, 0.9);
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 15px;
        transition: all 0.2s ease;
      }

      .btn-add-section:hover {
        background: rgba(70, 150, 255, 0.3);
        border-color: rgba(70, 150, 255, 0.6);
      }

      .quarter-year-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .button-group {
        display: flex;
        gap: 12px;
        margin-top: 32px;
      }

      .btn-primary {
        background: linear-gradient(180deg, var(--btn-primary), rgba(35, 105, 245, 0.88));
        border: 1px solid rgba(170, 220, 255, 0.5);
        color: rgba(255, 255, 255, 0.95);
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        flex: 1;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .btn-primary:hover {
        background: linear-gradient(180deg, var(--btn-primary-hover), rgba(45, 115, 255, 0.92));
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.9);
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        flex: 1;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .error-message {
        background: rgba(220, 38, 38, 0.2);
        border: 1px solid rgba(220, 38, 38, 0.4);
        color: rgba(255, 255, 255, 0.95);
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
      }

      @media (max-width: 640px) {
        .form-card {
          padding: 30px 24px;
        }

        .quarter-year-group {
          grid-template-columns: 1fr;
        }

        .button-group {
          flex-direction: column;
        }
      }
    </style>
</head>
<body class="bluevox-form">
    <div class="dashboard-layout">
        <!-- Sidebar Tab -->
        <div class="sidebar-tab sidebar-visible" id="sidebar-tab">
            <span class="sidebar-tab-icon" id="sidebar-tab-icon">◀</span>
        </div>
        
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-resize-handle" id="sidebar-resize-handle"></div>
            <div class="sidebar-logo">
                <div class="sidebar-brand-row">
                    <img class="sidebar-depaul-logo" src="/static/assets/depaul-logo.png" alt="DePaul" />
                    <div class="sidebar-divider" aria-hidden="true"></div>
                    <div class="sidebar-bluevox-text">BlueVox</div>
                </div>
                <img class="sidebar-shield" src="/static/assets/depaul-shield.png" alt="DePaul Shield" />
            </div>
            
            <nav class="nav-menu">
                <ul style="list-style: none; padding: 0;">
                    <li class="nav-item">
                        <a href="/teacher/dashboard" class="nav-link">
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/manage-students" class="nav-link">
                            Manage Students
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/exams" class="nav-link">
                            Exams
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/analytics" class="nav-link">
                            Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/notifications" class="nav-link">
                            Notifications
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/teacher/settings" class="nav-link">
                            Settings
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <a href="/" class="logout-btn">
                    Logout
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
    <div class="form-container">
        <div class="form-card">
            <div class="form-header">
                <h1>Register New Course</h1>
            </div>
            
            {% if error %}
            <div class="bluevox-message bluevox-message-error">
                {{ error }}
            </div>
            {% endif %}
            
            <form method="post" action="/teacher/register-course" id="register-course-form">
                <div class="form-group">
                    <label for="course_number">Course Number</label>
                    <input 
                        type="text" 
                        id="course_number" 
                        name="course_number" 
                        class="bluevox-input"
                        required 
                        autofocus
                        placeholder="e.g., CSC376"
                        pattern="[A-Za-z0-9]+"
                        title="Course number (letters and numbers only)"
                    >
                    <p class="info-text">Enter the course code (will be converted to uppercase automatically)</p>
                </div>
                
                <div class="form-group">
                    <label>Sections</label>
                    <div class="sections-container" id="sections-container">
                        <div class="section-input-group">
                            <input 
                                type="text" 
                                name="sections[]" 
                                class="bluevox-input"
                                required 
                                placeholder="e.g., 424"
                                pattern="[0-9]+"
                                title="Section number (numbers only)"
                            >
                        </div>
                    </div>
                    <button type="button" class="btn-add-section" id="add-section-btn">Add Another Section</button>
                </div>
                
                <div class="form-group">
                    <label>Quarter / Year</label>
                    <div class="quarter-year-group">
                        <div>
                            <label for="quarter" style="margin-bottom: 8px; display: block;">Quarter</label>
                            <select id="quarter" name="quarter" required>
                                <option value="">Select Quarter</option>
                                <option value="Fall">Fall</option>
                                <option value="Winter">Winter</option>
                                <option value="Spring">Spring</option>
                                <option value="Summer">Summer</option>
                            </select>
                        </div>
                        <div>
                            <label for="year" style="margin-bottom: 8px; display: block;">Year</label>
                            <select id="year" name="year" required>
                                <option value="">Select Year</option>
                                {% for year in year_options %}
                                <option value="{{ year }}">{{ year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <a href="/teacher/dashboard" class="btn-secondary" onclick="return confirmCancel(event);">Cancel</a>
                    <button type="submit" class="btn-primary">Register Course</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Auto-uppercase course number input
        document.getElementById('course_number').addEventListener('input', function(e) {
            this.value = this.value.toUpperCase();
        });

        // Add section button functionality
        document.getElementById('add-section-btn').addEventListener('click', function() {
            const container = document.getElementById('sections-container');
            const sectionCount = container.children.length;
            
            const newSectionGroup = document.createElement('div');
            newSectionGroup.className = 'section-input-group';
            newSectionGroup.innerHTML = `
                <input 
                    type="text" 
                    name="sections[]" 
                    required 
                    placeholder="e.g., 424"
                    pattern="[0-9]+"
                    title="Section number (numbers only)"
                >
                <button type="button" class="btn-remove-section" onclick="this.parentElement.remove()">Remove</button>
            `;
            
            container.appendChild(newSectionGroup);
            
            // Focus on new input
            newSectionGroup.querySelector('input').focus();
        });

        // Ensure at least one section exists
        document.getElementById('register-course-form').addEventListener('submit', function(e) {
            const sections = document.querySelectorAll('input[name="sections[]"]');
            if (sections.length === 0) {
                e.preventDefault();
                alert('Please add at least one section.');
                return false;
            }
            // Reset formChanged flag when form is submitted
            formChanged = false;
        });

        // Track form changes
        let formChanged = false;
        const form = document.getElementById('register-course-form');
        if (form) {
            const formInputs = form.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => {
                input.addEventListener('change', function() {
                    formChanged = true;
                });
                input.addEventListener('input', function() {
                    formChanged = true;
                });
            });
        }

        // Cancel button with warning
        function confirmCancel(e) {
            if (formChanged) {
                if (!confirm('You have entered information. Are you sure you want to cancel? All entered data will be lost.')) {
                    e.preventDefault();
                    return false;
                }
            }
            return true;
        }

        // Warn before leaving page if form has changes
        window.addEventListener('beforeunload', function(e) {
            if (formChanged) {
                e.preventDefault();
                e.returnValue = 'You have entered information. Are you sure you want to leave? All entered data will be lost.';
                return e.returnValue;
            }
        });
    </script>
        </main>
    </div>

    <script>
        // Sidebar Resize and Toggle Functionality
        (function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            const resizeHandle = document.getElementById('sidebar-resize-handle');
            const sidebarTab = document.getElementById('sidebar-tab');
            
            if (!sidebar || !mainContent || !resizeHandle || !sidebarTab) return;
            
            // Load saved sidebar state
            const savedWidth = localStorage.getItem('sidebarWidth');
            const savedVisibility = localStorage.getItem('sidebarVisible');
            
            // Define helper functions first
            function updateMainContentMargin(sidebarWidth) {
                if (!sidebar.classList.contains('collapsed')) {
                    mainContent.style.marginLeft = sidebarWidth + 'px';
                    mainContent.style.width = `calc(100vw - ${sidebarWidth}px)`;
                    mainContent.style.maxWidth = `calc(100vw - ${sidebarWidth}px)`;
                }
            }
            
            function updateTabPosition(sidebarWidth) {
                if (!sidebar.classList.contains('collapsed')) {
                    sidebarTab.style.left = sidebarWidth + 'px';
                }
            }
            
            const sidebarTabIcon = document.getElementById('sidebar-tab-icon');
            
            if (savedWidth) {
                sidebar.style.width = savedWidth + 'px';
                updateMainContentMargin(parseInt(savedWidth));
                updateTabPosition(parseInt(savedWidth));
            }
            
            if (savedVisibility === 'false') {
                // Initialize hidden state
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebar.style.left = `-${sidebarWidth}px`;
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-hidden');
                sidebarTab.classList.add('collapsed');
                sidebarTab.classList.remove('sidebar-visible');
                sidebarTab.style.left = '0';
                if (sidebarTabIcon) sidebarTabIcon.textContent = '▶';
                // Expand main content to full width
                mainContent.style.marginLeft = '0';
                mainContent.style.width = '100vw';
                mainContent.style.maxWidth = '100vw';
            }
            
            // Tab toggle functionality
            let isDraggingTab = false;
            let dragStartX = 0;
            let dragStartLeft = 0;
            let hasMoved = false;
            
            sidebarTab.addEventListener('mousedown', function(e) {
                isDraggingTab = true;
                hasMoved = false;
                dragStartX = e.clientX;
                dragStartLeft = sidebar.classList.contains('collapsed') ? 0 : parseInt(window.getComputedStyle(sidebar).width, 10);
                document.body.style.cursor = 'grabbing';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDraggingTab) return;
                
                const deltaX = e.clientX - dragStartX;
                
                // Check if user has moved the mouse significantly
                if (Math.abs(deltaX) > 5) {
                    hasMoved = true;
                }
                
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                const newLeft = dragStartLeft + deltaX;
                
                // Update tab position during drag for visual feedback
                if (sidebar.classList.contains('collapsed')) {
                    // When hidden, tab can only move right
                    sidebarTab.style.left = Math.max(0, newLeft) + 'px';
                } else {
                    // When visible, tab can only move left
                    sidebarTab.style.left = Math.min(sidebarWidth, newLeft) + 'px';
                }
            });
            
            document.addEventListener('mouseup', function(e) {
                if (isDraggingTab) {
                    const deltaX = e.clientX - dragStartX;
                    
                    // If user dragged significantly, toggle based on direction
                    if (hasMoved && Math.abs(deltaX) > 20) {
                        if (deltaX < -20 && !sidebar.classList.contains('collapsed')) {
                            // Dragged left - hide sidebar
                            hideSidebar();
                        } else if (deltaX > 20 && sidebar.classList.contains('collapsed')) {
                            // Dragged right - show sidebar
                            showSidebar();
                        } else {
                            // Reset tab position
                            resetTabPosition();
                        }
                    } else if (!hasMoved) {
                        // Simple click - toggle
                        if (sidebar.classList.contains('collapsed')) {
                            showSidebar();
                        } else {
                            hideSidebar();
                        }
                    } else {
                        // Small movement - reset position
                        resetTabPosition();
                    }
                    
                    isDraggingTab = false;
                    hasMoved = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
            
            function resetTabPosition() {
                const isHidden = sidebar.classList.contains('collapsed');
                if (isHidden) {
                    sidebarTab.style.left = '0';
                } else {
                    const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                    sidebarTab.style.left = sidebarWidth + 'px';
                }
            }
            
            const sidebarTabIcon = document.getElementById('sidebar-tab-icon');
            
            function hideSidebar() {
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebar.style.left = `-${sidebarWidth}px`;
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-hidden');
                sidebarTab.classList.add('collapsed');
                sidebarTab.classList.remove('sidebar-visible');
                sidebarTab.style.left = '0';
                if (sidebarTabIcon) sidebarTabIcon.textContent = '▶';
                // Expand main content to full width
                mainContent.style.marginLeft = '0';
                mainContent.style.width = '100vw';
                mainContent.style.maxWidth = '100vw';
                localStorage.setItem('sidebarVisible', 'false');
            }
            
            function showSidebar() {
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebar.style.left = '0';
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('sidebar-hidden');
                sidebarTab.classList.remove('collapsed');
                sidebarTab.classList.add('sidebar-visible');
                sidebarTab.style.left = sidebarWidth + 'px';
                if (sidebarTabIcon) sidebarTabIcon.textContent = '◀';
                // Adjust main content to account for sidebar
                updateMainContentMargin(sidebarWidth);
                localStorage.setItem('sidebarVisible', 'true');
            }
            
            function toggleSidebar() {
                if (sidebar.classList.contains('collapsed')) {
                    showSidebar();
                } else {
                    hideSidebar();
                }
            }
            
            // Resize functionality
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;
            
            resizeHandle.addEventListener('mousedown', function(e) {
                isResizing = true;
                startX = e.clientX;
                startWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                resizeHandle.classList.add('dragging');
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;
                
                const width = startWidth + (e.clientX - startX);
                const minWidth = 180;
                const maxWidth = 500;
                
                if (width >= minWidth && width <= maxWidth) {
                    sidebar.style.width = width + 'px';
                    updateMainContentMargin(width);
                    updateTabPosition(width);
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    resizeHandle.classList.remove('dragging');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    
                    // Save width to localStorage
                    const currentWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                    localStorage.setItem('sidebarWidth', currentWidth);
                }
            });
            
            // Initialize tab position
            if (!sidebar.classList.contains('collapsed')) {
                const sidebarWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                sidebarTab.style.left = sidebarWidth + 'px';
            }
        })();
    </script>
</body>
</html>
